{
  "name": "get_orderbook_metrics",
  "description": "Get L1 aggregated metrics for a trading pair order book including spread, microprice, imbalance, walls, and slippage estimates. Provides lightweight analysis without full depth data for optimal token economy. First request initializes WebSocket subscription (2-3s latency), subsequent requests are fast (<200ms). Part of progressive disclosure strategy: use this for quick liquidity assessment, escalate to get_orderbook_depth only when deeper analysis needed.",
  "inputSchema": {
    "type": "object",
    "properties": {
      "symbol": {
        "type": "string",
        "description": "Trading pair symbol (case-insensitive, will be uppercased). Example: BTCUSDT, ETHUSDT, BNBBTC. Must be a valid Binance spot trading pair.",
        "pattern": "^[A-Za-z0-9]+$",
        "minLength": 6,
        "maxLength": 12,
        "examples": ["BTCUSDT", "ETHUSDT", "BNBBTC"]
      }
    },
    "required": ["symbol"],
    "additionalProperties": false
  },
  "outputSchema": {
    "type": "object",
    "properties": {
      "symbol": {
        "type": "string",
        "description": "Trading pair symbol (uppercased)"
      },
      "timestamp": {
        "type": "integer",
        "format": "int64",
        "description": "Metrics calculation time in milliseconds since Unix epoch"
      },
      "spread_bps": {
        "type": "number",
        "format": "double",
        "description": "Spread in basis points: ((best_ask - best_bid) / best_bid) * 10000. Lower is better for tighter markets.",
        "minimum": 0
      },
      "microprice": {
        "type": "number",
        "format": "double",
        "description": "Volume-weighted fair price: (best_bid * ask_vol + best_ask * bid_vol) / (bid_vol + ask_vol). More accurate than mid-price for execution estimation."
      },
      "bid_volume": {
        "type": "number",
        "format": "double",
        "description": "Sum of top 20 bid level quantities (buy-side liquidity depth)"
      },
      "ask_volume": {
        "type": "number",
        "format": "double",
        "description": "Sum of top 20 ask level quantities (sell-side liquidity depth)"
      },
      "imbalance_ratio": {
        "type": "number",
        "format": "double",
        "description": "Bid/ask volume ratio: bid_volume / ask_volume. >1 indicates more buy pressure, <1 indicates more sell pressure.",
        "exclusiveMinimum": 0
      },
      "best_bid": {
        "type": "string",
        "description": "Highest bid price (string to preserve decimal precision)",
        "pattern": "^\\d+\\.\\d+$"
      },
      "best_ask": {
        "type": "string",
        "description": "Lowest ask price (string to preserve decimal precision)",
        "pattern": "^\\d+\\.\\d+$"
      },
      "walls": {
        "type": "object",
        "description": "Significant price levels with quantity > 2x median of top 20 levels (support/resistance zones)",
        "properties": {
          "bids": {
            "type": "array",
            "description": "Buy walls (large support levels)",
            "items": {
              "type": "object",
              "properties": {
                "price": {"type": "string", "description": "Price level"},
                "qty": {"type": "string", "description": "Quantity at this level"},
                "side": {"type": "string", "enum": ["Bid"], "description": "Always 'Bid' for bid walls"}
              },
              "required": ["price", "qty", "side"]
            }
          },
          "asks": {
            "type": "array",
            "description": "Sell walls (large resistance levels)",
            "items": {
              "type": "object",
              "properties": {
                "price": {"type": "string", "description": "Price level"},
                "qty": {"type": "string", "description": "Quantity at this level"},
                "side": {"type": "string", "enum": ["Ask"], "description": "Always 'Ask' for ask walls"}
              },
              "required": ["price", "qty", "side"]
            }
          }
        },
        "required": ["bids", "asks"]
      },
      "slippage_estimates": {
        "type": "object",
        "description": "VWAP-based slippage estimates for standard target amounts (10k, 25k, 50k USD). Null if insufficient liquidity.",
        "properties": {
          "buy_10k_usd": {
            "oneOf": [
              {"$ref": "#/$defs/SlippageEstimate"},
              {"type": "null"}
            ],
            "description": "Slippage for buying $10,000 worth"
          },
          "buy_25k_usd": {
            "oneOf": [
              {"$ref": "#/$defs/SlippageEstimate"},
              {"type": "null"}
            ]
          },
          "buy_50k_usd": {
            "oneOf": [
              {"$ref": "#/$defs/SlippageEstimate"},
              {"type": "null"}
            ]
          },
          "sell_10k_usd": {
            "oneOf": [
              {"$ref": "#/$defs/SlippageEstimate"},
              {"type": "null"}
            ],
            "description": "Slippage for selling $10,000 worth"
          },
          "sell_25k_usd": {
            "oneOf": [
              {"$ref": "#/$defs/SlippageEstimate"},
              {"type": "null"}
            ]
          },
          "sell_50k_usd": {
            "oneOf": [
              {"$ref": "#/$defs/SlippageEstimate"},
              {"type": "null"}
            ]
          }
        }
      }
    },
    "required": ["symbol", "timestamp", "spread_bps", "microprice", "bid_volume", "ask_volume", "imbalance_ratio", "best_bid", "best_ask", "walls", "slippage_estimates"],
    "additionalProperties": false,
    "$defs": {
      "SlippageEstimate": {
        "type": "object",
        "properties": {
          "target_usd": {
            "type": "number",
            "format": "double",
            "description": "Target amount in USD (10000, 25000, or 50000)",
            "enum": [10000, 25000, 50000]
          },
          "avg_price": {
            "type": "number",
            "format": "double",
            "description": "Volume-weighted average price for this fill"
          },
          "slippage_bps": {
            "type": "number",
            "format": "double",
            "description": "Slippage in basis points: ((avg_price - best_price) / best_price) * 10000",
            "minimum": 0
          },
          "filled_qty": {
            "type": "number",
            "format": "double",
            "description": "Actual quantity filled (may be less than target if liquidity insufficient)"
          },
          "filled_usd": {
            "type": "number",
            "format": "double",
            "description": "Actual USD amount filled (may be less than target)"
          }
        },
        "required": ["target_usd", "avg_price", "slippage_bps", "filled_qty", "filled_usd"]
      }
    }
  },
  "errors": [
    {
      "code": "SYMBOL_NOT_FOUND",
      "message": "Symbol not found or not supported. Verify symbol is a valid Binance spot trading pair."
    },
    {
      "code": "SYMBOL_LIMIT_REACHED",
      "message": "Maximum concurrent symbols (20) reached. Close unused symbols to free capacity."
    },
    {
      "code": "RATE_LIMIT_EXCEEDED",
      "message": "Request queue full, rate limit exceeded. Retry after delay."
    },
    {
      "code": "INITIALIZATION_FAILED",
      "message": "Failed to initialize order book. WebSocket connection or snapshot fetch failed after retries."
    }
  ],
  "examples": [
    {
      "description": "Get metrics for BTCUSDT",
      "input": {
        "symbol": "BTCUSDT"
      },
      "output": {
        "symbol": "BTCUSDT",
        "timestamp": 1699999999123,
        "spread_bps": 0.49,
        "microprice": 67650.31,
        "bid_volume": 25.73,
        "ask_volume": 21.12,
        "imbalance_ratio": 1.218,
        "best_bid": "67650.00",
        "best_ask": "67650.50",
        "walls": {
          "bids": [
            {"price": "67600.00", "qty": "5.5", "side": "Bid"}
          ],
          "asks": [
            {"price": "67750.00", "qty": "6.2", "side": "Ask"}
          ]
        },
        "slippage_estimates": {
          "buy_10k_usd": {
            "target_usd": 10000,
            "avg_price": 67662.1,
            "slippage_bps": 1.8,
            "filled_qty": 0.1478,
            "filled_usd": 10000.0
          },
          "sell_10k_usd": {
            "target_usd": 10000,
            "avg_price": 67638.0,
            "slippage_bps": 1.9,
            "filled_qty": 0.1478,
            "filled_usd": 10000.0
          },
          "buy_25k_usd": null,
          "buy_50k_usd": null,
          "sell_25k_usd": null,
          "sell_50k_usd": null
        }
      }
    }
  ]
}
